(()=>{var e={};e.id=465,e.ids=[465],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2642:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c});var r=t(482),a=t(9108),n=t(2563),i=t.n(n),l=t(8300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let c=["",{children:["(dashboard)",{children:["servers",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,3093)),"/Users/rizkyakbar/Projects/mine/LoadTest/load-test-client/app/(dashboard)/servers/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,8519)),"/Users/rizkyakbar/Projects/mine/LoadTest/load-test-client/app/(dashboard)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,2917)),"/Users/rizkyakbar/Projects/mine/LoadTest/load-test-client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/rizkyakbar/Projects/mine/LoadTest/load-test-client/app/(dashboard)/servers/page.tsx"],x="/(dashboard)/servers/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(dashboard)/servers/page",pathname:"/servers",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1033:(e,s,t)=>{Promise.resolve().then(t.bind(t,941))},941:(e,s,t)=>{"use strict";t.r(s),t.d(s,{ServersOverview:()=>v});var r=t(5344),a=t(3729),n=t(8428),i=t(9591),l=t(5094),d=t(3673),c=t(6540),o=t(7361);let x={up:"text-success",down:"text-danger",steady:"text-slate-400"},m={up:"▲",down:"▼",steady:"■"};function u({title:e,description:s,value:t,delta:a}){return(0,r.jsxs)(d.Zb,{className:"shadow-card",children:[(0,r.jsxs)(d.Ol,{children:[r.jsx(d.ll,{children:e}),r.jsx(d.SZ,{children:s})]}),r.jsx(d.aY,{children:(0,r.jsxs)("div",{className:"flex items-end justify-between",children:[r.jsx("span",{className:"text-3xl font-semibold text-slate-100",children:t}),a?(0,r.jsxs)("span",{className:`text-sm font-medium ${x[a.intent]}`,children:[m[a.intent]," ",a.value]}):null]})})]})}let p=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit"});function h(e){if(!e)return"—";let s=new Date(e);return Number.isNaN(s.getTime())?"—":p.format(s)}let g={organizationId:"",name:"",hostname:"",description:""};function v({servers:e,organizations:s}){let t=(0,n.useRouter)(),[x,m]=(0,a.useState)({}),[p,v]=(0,a.useState)({}),[j,b]=(0,a.useState)(null),[f,y]=(0,a.useTransition)(),[N,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[_,z]=(0,a.useState)(null),[P,C]=(0,a.useState)(g),A=e.length,O=e.filter(e=>e.isSuspended).length,T=e.filter(e=>!!e.organization.scanSuspendedAt).length,q=new Set(e.map(e=>e.organization.id)).size,I=(0,a.useMemo)(()=>[...s].sort((e,s)=>e.name.localeCompare(s.name)),[s]),Z=e=>{b(e),y(async()=>{v(s=>({...s,[e]:void 0}));try{let s=await fetch(`/api/servers/${e}/agents`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error??"Failed to create agent.")}let t=await s.json();if(!t.credentials)throw Error("Agent credentials were not returned.");m(s=>({...s,[e]:t.credentials}))}catch(t){let s=t instanceof Error?t.message:"An unexpected error occurred while creating the agent.";v(t=>({...t,[e]:s}))}finally{b(null)}})},L=()=>{C(g),z(null)},R=e=>s=>{C(t=>({...t,[e]:s.target.value}))},U=async e=>{if(e.preventDefault(),!P.organizationId||!P.name.trim()){z("Organization and server name are required.");return}S(!0),z(null);try{let e=await fetch("/api/servers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:P.organizationId,name:P.name.trim(),hostname:P.hostname.trim()||void 0,description:P.description.trim()||void 0})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error??"Failed to register server.")}L(),w(!1),t.refresh()}catch(e){z(e instanceof Error?e.message:"An unexpected error occurred while registering the server.")}finally{S(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 rounded-3xl border border-slate-800/70 bg-slate-950/50 p-5 shadow-[0_45px_120px_-90px_rgba(15,118,110,0.45)] backdrop-blur-xl",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Register a new server"}),r.jsx("p",{className:"text-sm text-slate-400",children:"Servers must belong to an organization you manage. After registration, mint an agent token to bootstrap the host."})]}),r.jsx(l.z,{variant:"primary",className:"w-full md:w-auto",onClick:()=>w(e=>!e),children:N?"Close form":"Register Server"})]}),N?(0,r.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:U,children:[(0,r.jsxs)("div",{className:"space-y-2 md:col-span-1",children:[r.jsx(o._,{htmlFor:"server-organization",children:"Organization"}),(0,r.jsxs)("select",{id:"server-organization",name:"organizationId",className:"w-full rounded-md border border-slate-700/70 bg-slate-950/70 px-3 py-2 text-sm text-slate-100 focus:border-accent-soft focus:outline-none",value:P.organizationId,onChange:R("organizationId"),required:!0,children:[r.jsx("option",{value:"",disabled:!0,children:"Select organization…"}),I.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," \xb7 ",e.credits," credits"]},e.id))]})]}),(0,r.jsxs)("div",{className:"space-y-2 md:col-span-1",children:[r.jsx(o._,{htmlFor:"server-name",children:"Server name"}),r.jsx(c.I,{id:"server-name",name:"name",placeholder:"Primary staging node",value:P.name,onChange:R("name"),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2 md:col-span-1",children:[r.jsx(o._,{htmlFor:"server-hostname",children:"Hostname (optional)"}),r.jsx(c.I,{id:"server-hostname",name:"hostname",placeholder:"staging01.internal",value:P.hostname,onChange:R("hostname")})]}),(0,r.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[r.jsx(o._,{htmlFor:"server-description",children:"Description (optional)"}),r.jsx("textarea",{id:"server-description",name:"description",placeholder:"Kubernetes worker node in the staging cluster.",className:"min-h-[90px] w-full rounded-md border border-slate-700/70 bg-slate-950/70 px-3 py-2 text-sm text-slate-100 focus:border-accent-soft focus:outline-none",value:P.description,onChange:R("description")})]}),_?r.jsx("p",{className:"md:col-span-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:_}):null,r.jsx("div",{className:"md:col-span-2 flex flex-col gap-3 md:flex-row md:items-center md:justify-end",children:r.jsx(l.z,{type:"submit",disabled:k,className:"w-full md:w-auto",children:k?"Registering…":"Save server"})})]}):null]}),(0,r.jsxs)(d.Zb,{className:"border-slate-800/70 bg-slate-950/60",children:[(0,r.jsxs)(d.Ol,{children:[r.jsx(d.ll,{className:"text-slate-100",children:"Agent installation guide"}),r.jsx(d.SZ,{className:"text-slate-400",children:"Deploy the server agent after minting credentials. These instructions target Ubuntu/Debian hosts with sudo access."})]}),(0,r.jsxs)(d.aY,{className:"space-y-4 text-sm text-slate-300",children:[(0,r.jsxs)("ol",{className:"space-y-3 pl-4",children:[(0,r.jsxs)("li",{className:"list-decimal",children:["Install the helper bundle:",r.jsx("pre",{className:"mt-2 overflow-x-auto rounded-lg bg-slate-950/80 p-3 text-xs text-accent-soft",children:"curl -fsSL https://cdn.loadtest.dev/agents/install.sh | sudo bash"})]}),(0,r.jsxs)("li",{className:"list-decimal",children:["Update ",r.jsx("code",{children:"/etc/loadtest-agent/config.yaml"})," with the access key and secret you just minted:",r.jsx("pre",{className:"mt-2 overflow-x-auto rounded-lg bg-slate-950/80 p-3 text-xs text-slate-200",children:`server_id: <server-id>
agent_access_key: <access-key>
agent_secret: <secret>
api_url: http://localhost:3001
poll_interval_seconds: 30
telemetry_interval_minutes: 5`})]}),(0,r.jsxs)("li",{className:"list-decimal",children:["Restart the service and confirm it is running:",r.jsx("pre",{className:"mt-2 overflow-x-auto rounded-lg bg-slate-950/80 p-3 text-xs text-accent-soft",children:"sudo systemctl restart loadtest-agent && sudo systemctl status loadtest-agent"})]})]}),(0,r.jsxs)("p",{className:"text-xs text-slate-500",children:["Need more detail? Check ",r.jsx("code",{children:"docs/server-agent-plan.md"})," for architecture notes and troubleshooting."]})]})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[r.jsx(u,{title:"Registered Servers",description:"Hosts monitored by the command center",value:A.toString()}),r.jsx(u,{title:"Suspended Servers",description:"Hosts paused due to manual or credit actions",value:O.toString()}),r.jsx(u,{title:"Orgs with Scan Suspension",description:"Organizations blocked from agent activity",value:T.toString()}),r.jsx(u,{title:"Active Organizations",description:"Unique orgs represented across servers",value:q.toString()})]}),r.jsx("div",{className:"space-y-4",children:0===e.length?r.jsx(d.Zb,{className:"border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsxs)(d.Ol,{children:[r.jsx(d.ll,{className:"text-slate-200",children:"No servers yet"}),r.jsx(d.SZ,{className:"text-slate-400",children:"Provision a server from the API or the form above to start orchestrating scan jobs and telemetry ingestion."})]})}):e.map(e=>{let s=e.organization,t=!!s.scanSuspendedAt,n=e.isSuspended?"Server suspended":t?"Org suspended":"Active",c=e.isSuspended||t?"warning":"success",o=x[e.id],m=p[e.id],u=f&&j===e.id;return(0,r.jsxs)(d.Zb,{className:"border-slate-800/80 bg-slate-950/50 shadow-[0_40px_120px_-90px_rgba(15,118,110,0.45)] backdrop-blur-xl",children:[(0,r.jsxs)(d.Ol,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx(d.ll,{className:"text-slate-100",children:e.name}),r.jsx(d.SZ,{className:"text-slate-400",children:e.hostname??"Hostname pending"})]}),r.jsx(i.C,{variant:"default",className:"success"===c?"bg-emerald-500/10 text-emerald-300":"bg-amber-500/10 text-amber-200",children:n})]}),(0,r.jsxs)(d.aY,{className:"space-y-4 text-sm text-slate-300",children:[r.jsx(l.z,{variant:"primary",className:"w-full md:w-auto",onClick:()=>Z(e.id),disabled:u,children:u?"Creating agent…":"Create Agent Token"}),r.jsx("p",{className:"text-xs text-slate-500",children:"This action revokes previous agent credentials and displays the new secret once."}),m?r.jsx("p",{className:"rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:m}):null,o?(0,r.jsxs)("div",{className:"space-y-2 rounded-xl border border-accent-strong/30 bg-accent-strong/10 p-3 text-xs",children:[r.jsx("p",{className:"font-semibold text-accent-soft",children:"Agent credentials for this server \xb7 shown only once. Store them in your secrets manager immediately."}),(0,r.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"uppercase tracking-wide text-[11px] text-accent-soft/70",children:"Access key"}),r.jsx("pre",{className:"mt-1 select-all overflow-x-auto rounded-lg bg-slate-950/80 p-2 text-[11px] text-accent-soft",children:o.accessKey})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"uppercase tracking-wide text-[11px] text-accent-soft/70",children:"Secret"}),r.jsx("pre",{className:"mt-1 select-all overflow-x-auto rounded-lg bg-slate-950/80 p-2 text-[11px] text-amber-200",children:o.secret})]})]})]}):null,e.description?r.jsx("p",{className:"text-slate-400",children:e.description}):null,r.jsx("dl",{className:"grid gap-3 md:grid-cols-2",children:(0,r.jsxs)(a.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Organization"}),r.jsx("dd",{className:"text-slate-200",children:s.name})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Credits Remaining"}),r.jsx("dd",{className:"font-medium text-slate-200",children:s.credits})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Last Scan Debit"}),r.jsx("dd",{children:h(s.lastDebitAt)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Last Credit Top-up"}),r.jsx("dd",{children:h(s.lastCreditedAt)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Registered On"}),r.jsx("dd",{children:h(e.createdAt)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Last Updated"}),r.jsx("dd",{children:h(e.updatedAt)})]})]})})]})]},e.id)})})]})}},9591:(e,s,t)=>{"use strict";t.d(s,{C:()=>i});var r=t(5344),a=t(1453);let n={default:"bg-surface-muted text-slate-200",success:"bg-success/20 text-success border border-success/40",warning:"bg-warning/20 text-warning border border-warning/40",danger:"bg-danger/20 text-danger border border-danger/40"};function i({className:e,variant:s="default",...t}){return r.jsx("span",{className:(0,a.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium uppercase tracking-wide",n[s],e),...t})}},3673:(e,s,t)=>{"use strict";t.d(s,{Ol:()=>i,SZ:()=>d,Zb:()=>n,aY:()=>c,ll:()=>l});var r=t(5344),a=t(1453);function n({className:e,children:s,...t}){return r.jsx("div",{className:(0,a.cn)("rounded-xl border border-slate-800/80 bg-surface-subtle/80 shadow-card backdrop-blur-sm",e),...t,children:s})}function i({className:e,children:s}){return r.jsx("div",{className:(0,a.cn)("border-b border-slate-800/40 px-6 py-4",e),children:s})}function l({className:e,children:s}){return r.jsx("h3",{className:(0,a.cn)("text-lg font-semibold text-slate-100",e),children:s})}function d({className:e,children:s}){return r.jsx("p",{className:(0,a.cn)("text-sm text-slate-400",e),children:s})}function c({className:e,children:s}){return r.jsx("div",{className:(0,a.cn)("px-6 py-5",e),children:s})}},6540:(e,s,t)=>{"use strict";t.d(s,{I:()=>i});var r=t(5344),a=t(3729),n=t(1453);let i=(0,a.forwardRef)(({className:e,type:s="text",...t},a)=>r.jsx("input",{ref:a,type:s,className:(0,n.cn)("w-full rounded-md border border-slate-800 bg-background-subtle px-3 py-2 text-sm text-slate-100 shadow-sm transition focus:border-accent-soft focus:ring-2 focus:ring-accent-soft/60",e),...t}));i.displayName="Input"},7361:(e,s,t)=>{"use strict";t.d(s,{_:()=>n});var r=t(5344),a=t(1453);function n({className:e,...s}){return r.jsx("label",{className:(0,a.cn)("block text-sm font-medium text-slate-300 tracking-wide",e),...s})}},3093:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var r=t(5036),a=t(7439),n=t(6843);let i=(0,n.createProxy)(String.raw`/Users/rizkyakbar/Projects/mine/LoadTest/load-test-client/src/components/dashboard/servers-overview.tsx`),{__esModule:l,$$typeof:d}=i;i.default;let c=(0,n.createProxy)(String.raw`/Users/rizkyakbar/Projects/mine/LoadTest/load-test-client/src/components/dashboard/servers-overview.tsx#ServersOverview`);var o=t(3560);async function x(){let e="http://localhost:3001",s=a.cookies().get("lt_token")?.value,[t,n]=await Promise.all([(0,o.VS)(e,s),(0,o.ZC)(e,s)]);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("h2",{className:"text-2xl font-semibold text-slate-100",children:"Servers"}),r.jsx("span",{className:"rounded-full border border-accent-soft/40 bg-accent-soft/10 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-accent-soft",children:"Beta"})]}),r.jsx("p",{className:"text-sm text-slate-400",children:"Track infrastructure connected to the Server Monitoring Command Center, monitor credit impact, and verify which organizations are ready for the next scan run."})]}),r.jsx(c,{servers:t,organizations:n})]})}}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[638,439,356,630,743],()=>t(2642));module.exports=r})();