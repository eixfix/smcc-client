(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[465],{8217:function(e,t,s){Promise.resolve().then(s.bind(s,4593))},7907:function(e,t,s){"use strict";var r=s(5313);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},4593:function(e,t,s){"use strict";s.r(t),s.d(t,{ServersOverview:function(){return f}});var r=s(3827),a=s(4090),n=s(7907),i=s(3277),l=s(575),c=s(5671),d=s(2782),o=s(2647);let u={up:"text-success",down:"text-danger",steady:"text-slate-400"},x={up:"▲",down:"▼",steady:"■"};function m(e){let{title:t,description:s,value:a,delta:n}=e;return(0,r.jsxs)(c.Zb,{className:"shadow-card",children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsx)(c.ll,{children:t}),(0,r.jsx)(c.SZ,{children:s})]}),(0,r.jsx)(c.aY,{children:(0,r.jsxs)("div",{className:"flex items-end justify-between",children:[(0,r.jsx)("span",{className:"text-3xl font-semibold text-slate-100",children:a}),n?(0,r.jsxs)("span",{className:"text-sm font-medium ".concat(u[n.intent]),children:[x[n.intent]," ",n.value]}):null]})})]})}let h=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit"});function p(e){if(!e)return"—";let t=new Date(e);return Number.isNaN(t.getTime())?"—":h.format(t)}let g={organizationId:"",name:"",hostname:"",description:""};function f(e){let{servers:t,organizations:s}=e,u=(0,n.useRouter)(),[x,h]=(0,a.useState)({}),[f,b]=(0,a.useState)({}),[v,j]=(0,a.useState)(null),[N,y]=(0,a.useTransition)(),[w,S]=(0,a.useState)(!1),[k,_]=(0,a.useState)(!1),[z,A]=(0,a.useState)(null),[C,O]=(0,a.useState)(g),I=t.length,R=t.filter(e=>e.isSuspended).length,P=t.filter(e=>!!e.organization.scanSuspendedAt).length,T=new Set(t.map(e=>e.organization.id)).size,Z=(0,a.useMemo)(()=>[...s].sort((e,t)=>e.name.localeCompare(t.name)),[s]),D=e=>{j(e),y(async()=>{b(t=>({...t,[e]:void 0}));try{let s=await fetch("/api/servers/".concat(e,"/agents"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok){var t;let e=await s.json().catch(()=>({}));throw Error(null!==(t=e.error)&&void 0!==t?t:"Failed to create agent.")}let r=await s.json();if(!r.credentials)throw Error("Agent credentials were not returned.");h(t=>({...t,[e]:r.credentials}))}catch(s){let t=s instanceof Error?s.message:"An unexpected error occurred while creating the agent.";b(s=>({...s,[e]:t}))}finally{j(null)}})},E=()=>{O(g),A(null)},F=e=>t=>{O(s=>({...s,[e]:t.target.value}))},q=async e=>{if(e.preventDefault(),!C.organizationId||!C.name.trim()){A("Organization and server name are required.");return}_(!0),A(null);try{let e=await fetch("/api/servers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:C.organizationId,name:C.name.trim(),hostname:C.hostname.trim()||void 0,description:C.description.trim()||void 0})});if(!e.ok){var t;let s=await e.json().catch(()=>({}));throw Error(null!==(t=s.error)&&void 0!==t?t:"Failed to register server.")}E(),S(!1),u.refresh()}catch(e){A(e instanceof Error?e.message:"An unexpected error occurred while registering the server.")}finally{_(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 rounded-3xl border border-slate-800/70 bg-slate-950/50 p-5 shadow-[0_45px_120px_-90px_rgba(15,118,110,0.45)] backdrop-blur-xl",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-slate-100",children:"Register a new server"}),(0,r.jsx)("p",{className:"text-sm text-slate-400",children:"Servers must belong to an organization you manage. After registration, mint an agent token to bootstrap the host."})]}),(0,r.jsx)(l.z,{variant:"primary",className:"w-full md:w-auto",onClick:()=>S(e=>!e),children:w?"Close form":"Register Server"})]}),w?(0,r.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:q,children:[(0,r.jsxs)("div",{className:"space-y-2 md:col-span-1",children:[(0,r.jsx)(o._,{htmlFor:"server-organization",children:"Organization"}),(0,r.jsxs)("select",{id:"server-organization",name:"organizationId",className:"w-full rounded-md border border-slate-700/70 bg-slate-950/70 px-3 py-2 text-sm text-slate-100 focus:border-accent-soft focus:outline-none",value:C.organizationId,onChange:F("organizationId"),required:!0,children:[(0,r.jsx)("option",{value:"",disabled:!0,children:"Select organization…"}),Z.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," \xb7 ",e.credits," credits"]},e.id))]})]}),(0,r.jsxs)("div",{className:"space-y-2 md:col-span-1",children:[(0,r.jsx)(o._,{htmlFor:"server-name",children:"Server name"}),(0,r.jsx)(d.I,{id:"server-name",name:"name",placeholder:"Primary staging node",value:C.name,onChange:F("name"),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2 md:col-span-1",children:[(0,r.jsx)(o._,{htmlFor:"server-hostname",children:"Hostname (optional)"}),(0,r.jsx)(d.I,{id:"server-hostname",name:"hostname",placeholder:"staging01.internal",value:C.hostname,onChange:F("hostname")})]}),(0,r.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,r.jsx)(o._,{htmlFor:"server-description",children:"Description (optional)"}),(0,r.jsx)("textarea",{id:"server-description",name:"description",placeholder:"Kubernetes worker node in the staging cluster.",className:"min-h-[90px] w-full rounded-md border border-slate-700/70 bg-slate-950/70 px-3 py-2 text-sm text-slate-100 focus:border-accent-soft focus:outline-none",value:C.description,onChange:F("description")})]}),z?(0,r.jsx)("p",{className:"md:col-span-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:z}):null,(0,r.jsx)("div",{className:"md:col-span-2 flex flex-col gap-3 md:flex-row md:items-center md:justify-end",children:(0,r.jsx)(l.z,{type:"submit",disabled:k,className:"w-full md:w-auto",children:k?"Registering…":"Save server"})})]}):null]}),(0,r.jsxs)(c.Zb,{className:"border-slate-800/70 bg-slate-950/60",children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsx)(c.ll,{className:"text-slate-100",children:"Agent installation guide"}),(0,r.jsx)(c.SZ,{className:"text-slate-400",children:"Deploy the server agent after minting credentials. These instructions target Ubuntu/Debian hosts with sudo access."})]}),(0,r.jsxs)(c.aY,{className:"space-y-4 text-sm text-slate-300",children:[(0,r.jsxs)("ol",{className:"space-y-3 pl-4",children:[(0,r.jsxs)("li",{className:"list-decimal",children:["Install the helper bundle:",(0,r.jsx)("pre",{className:"mt-2 overflow-x-auto rounded-lg bg-slate-950/80 p-3 text-xs text-accent-soft",children:"curl -fsSL https://cdn.loadtest.dev/agents/install.sh | sudo bash"})]}),(0,r.jsxs)("li",{className:"list-decimal",children:["Update ",(0,r.jsx)("code",{children:"/etc/loadtest-agent/config.yaml"})," with the access key and secret you just minted:",(0,r.jsx)("pre",{className:"mt-2 overflow-x-auto rounded-lg bg-slate-950/80 p-3 text-xs text-slate-200",children:"server_id: <server-id>\nagent_access_key: <access-key>\nagent_secret: <secret>\napi_url: ".concat("http://localhost:3001","\npoll_interval_seconds: 30\ntelemetry_interval_minutes: 5")})]}),(0,r.jsxs)("li",{className:"list-decimal",children:["Restart the service and confirm it is running:",(0,r.jsx)("pre",{className:"mt-2 overflow-x-auto rounded-lg bg-slate-950/80 p-3 text-xs text-accent-soft",children:"sudo systemctl restart loadtest-agent && sudo systemctl status loadtest-agent"})]})]}),(0,r.jsxs)("p",{className:"text-xs text-slate-500",children:["Need more detail? Check ",(0,r.jsx)("code",{children:"docs/server-agent-plan.md"})," for architecture notes and troubleshooting."]})]})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[(0,r.jsx)(m,{title:"Registered Servers",description:"Hosts monitored by the command center",value:I.toString()}),(0,r.jsx)(m,{title:"Suspended Servers",description:"Hosts paused due to manual or credit actions",value:R.toString()}),(0,r.jsx)(m,{title:"Orgs with Scan Suspension",description:"Organizations blocked from agent activity",value:P.toString()}),(0,r.jsx)(m,{title:"Active Organizations",description:"Unique orgs represented across servers",value:T.toString()})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===t.length?(0,r.jsx)(c.Zb,{className:"border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsxs)(c.Ol,{children:[(0,r.jsx)(c.ll,{className:"text-slate-200",children:"No servers yet"}),(0,r.jsx)(c.SZ,{className:"text-slate-400",children:"Provision a server from the API or the form above to start orchestrating scan jobs and telemetry ingestion."})]})}):t.map(e=>{var t;let s=e.organization,n=!!s.scanSuspendedAt,d=e.isSuspended?"Server suspended":n?"Org suspended":"Active",o=e.isSuspended||n?"warning":"success",u=x[e.id],m=f[e.id],h=N&&v===e.id;return(0,r.jsxs)(c.Zb,{className:"border-slate-800/80 bg-slate-950/50 shadow-[0_40px_120px_-90px_rgba(15,118,110,0.45)] backdrop-blur-xl",children:[(0,r.jsxs)(c.Ol,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c.ll,{className:"text-slate-100",children:e.name}),(0,r.jsx)(c.SZ,{className:"text-slate-400",children:null!==(t=e.hostname)&&void 0!==t?t:"Hostname pending"})]}),(0,r.jsx)(i.C,{variant:"default",className:"success"===o?"bg-emerald-500/10 text-emerald-300":"bg-amber-500/10 text-amber-200",children:d})]}),(0,r.jsxs)(c.aY,{className:"space-y-4 text-sm text-slate-300",children:[(0,r.jsx)(l.z,{variant:"primary",className:"w-full md:w-auto",onClick:()=>D(e.id),disabled:h,children:h?"Creating agent…":"Create Agent Token"}),(0,r.jsx)("p",{className:"text-xs text-slate-500",children:"This action revokes previous agent credentials and displays the new secret once."}),m?(0,r.jsx)("p",{className:"rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:m}):null,u?(0,r.jsxs)("div",{className:"space-y-2 rounded-xl border border-accent-strong/30 bg-accent-strong/10 p-3 text-xs",children:[(0,r.jsx)("p",{className:"font-semibold text-accent-soft",children:"Agent credentials for this server \xb7 shown only once. Store them in your secrets manager immediately."}),(0,r.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"uppercase tracking-wide text-[11px] text-accent-soft/70",children:"Access key"}),(0,r.jsx)("pre",{className:"mt-1 select-all overflow-x-auto rounded-lg bg-slate-950/80 p-2 text-[11px] text-accent-soft",children:u.accessKey})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"uppercase tracking-wide text-[11px] text-accent-soft/70",children:"Secret"}),(0,r.jsx)("pre",{className:"mt-1 select-all overflow-x-auto rounded-lg bg-slate-950/80 p-2 text-[11px] text-amber-200",children:u.secret})]})]})]}):null,e.description?(0,r.jsx)("p",{className:"text-slate-400",children:e.description}):null,(0,r.jsx)("dl",{className:"grid gap-3 md:grid-cols-2",children:(0,r.jsxs)(a.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Organization"}),(0,r.jsx)("dd",{className:"text-slate-200",children:s.name})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Credits Remaining"}),(0,r.jsx)("dd",{className:"font-medium text-slate-200",children:s.credits})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Last Scan Debit"}),(0,r.jsx)("dd",{children:p(s.lastDebitAt)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Last Credit Top-up"}),(0,r.jsx)("dd",{children:p(s.lastCreditedAt)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Registered On"}),(0,r.jsx)("dd",{children:p(e.createdAt)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Last Updated"}),(0,r.jsx)("dd",{children:p(e.updatedAt)})]})]})})]})]},e.id)})})]})}},3277:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var r=s(3827),a=s(2169);let n={default:"bg-surface-muted text-slate-200",success:"bg-success/20 text-success border border-success/40",warning:"bg-warning/20 text-warning border border-warning/40",danger:"bg-danger/20 text-danger border border-danger/40"};function i(e){let{className:t,variant:s="default",...i}=e;return(0,r.jsx)("span",{className:(0,a.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium uppercase tracking-wide",n[s],t),...i})}},575:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var r=s(3827),a=s(4090),n=s(2169);let i={primary:"bg-accent-strong text-slate-950 hover:bg-accent-soft disabled:bg-accent-soft/50 disabled:text-slate-900/60",secondary:"bg-surface-muted text-slate-100 hover:bg-surface-subtle disabled:opacity-60 border border-slate-700/60",ghost:"bg-transparent text-slate-300 hover:bg-surface-subtle/50 disabled:opacity-40"},l=(0,a.forwardRef)((e,t)=>{let{className:s,variant:a="primary",type:l="button",...c}=e;return(0,r.jsx)("button",{ref:t,type:l,className:(0,n.cn)("inline-flex items-center justify-center rounded-md text-sm font-semibold transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-soft focus-visible:ring-offset-2 focus-visible:ring-offset-background",i[a],"px-4 py-2",s),...c})});l.displayName="Button"},5671:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return n},aY:function(){return d},ll:function(){return l}});var r=s(3827),a=s(2169);function n(e){let{className:t,children:s,...n}=e;return(0,r.jsx)("div",{className:(0,a.cn)("rounded-xl border border-slate-800/80 bg-surface-subtle/80 shadow-card backdrop-blur-sm",t),...n,children:s})}function i(e){let{className:t,children:s}=e;return(0,r.jsx)("div",{className:(0,a.cn)("border-b border-slate-800/40 px-6 py-4",t),children:s})}function l(e){let{className:t,children:s}=e;return(0,r.jsx)("h3",{className:(0,a.cn)("text-lg font-semibold text-slate-100",t),children:s})}function c(e){let{className:t,children:s}=e;return(0,r.jsx)("p",{className:(0,a.cn)("text-sm text-slate-400",t),children:s})}function d(e){let{className:t,children:s}=e;return(0,r.jsx)("div",{className:(0,a.cn)("px-6 py-5",t),children:s})}},2782:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var r=s(3827),a=s(4090),n=s(2169);let i=(0,a.forwardRef)((e,t)=>{let{className:s,type:a="text",...i}=e;return(0,r.jsx)("input",{ref:t,type:a,className:(0,n.cn)("w-full rounded-md border border-slate-800 bg-background-subtle px-3 py-2 text-sm text-slate-100 shadow-sm transition focus:border-accent-soft focus:ring-2 focus:ring-accent-soft/60",s),...i})});i.displayName="Input"},2647:function(e,t,s){"use strict";s.d(t,{_:function(){return n}});var r=s(3827),a=s(2169);function n(e){let{className:t,...s}=e;return(0,r.jsx)("label",{className:(0,a.cn)("block text-sm font-medium text-slate-300 tracking-wide",t),...s})}},2169:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var r=s(3167);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.W)(t)}},3167:function(e,t,s){"use strict";function r(){for(var e,t,s=0,r="",a=arguments.length;s<a;s++)(e=arguments[s])&&(t=function e(t){var s,r,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var n=t.length;for(s=0;s<n;s++)t[s]&&(r=e(t[s]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r)}return a}(e))&&(r&&(r+=" "),r+=t);return r}s.d(t,{W:function(){return r}})}},function(e){e.O(0,[971,69,744],function(){return e(e.s=8217)}),_N_E=e.O()}]);